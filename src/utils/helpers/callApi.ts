import { $axios } from '@/libs/axios'
import type { SchemaOf } from '@/types'
import type { paths } from '@/types/openapi/autoGenerated'

export type PathParams = {
  [key: string]: string | number | null
}

const replaceUrlParams = (url: string, params?: PathParams) => {
  if (params === undefined) return url

  return Object.entries(params).reduce((accUrl, [key, value]) => {
    if (value === null) return accUrl
    return accUrl.replace(`{${key}}`, value.toString())
  }, url)
}

/**
 * データ取得用API
 */
export const fetchData = async <U extends keyof paths>(
  url: U,
  params?: PathParams
) => {
  const apiUrl = replaceUrlParams(url, params)
  return await $axios.get<SchemaOf<U, 'get'>>(apiUrl)
}
